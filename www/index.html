<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>CarGas</title>

        <!-- compiled css output -->
        <link href="css/ionic.app.min.css" rel="stylesheet">

        <!-- ionic/angularjs js -->
        <script src="lib/ionic/js/ionic.bundle.js"></script>
        <script src="lib/angular-resource/angular-resource.js"></script>
        <script src="lib/underscore/underscore.js"></script>
        <script src="lib/angular-translate/angular-translate.js"></script>
        <script src="lib/angular-translate-loader-static-files/angular-translate-loader-static-files.js"></script>
        <script src="lib/angular-dynamic-locale/tmhDynamicLocale.min.js"></script>

        <!-- firebase -->
        <script src="lib/firebase/firebase.js"></script>

        <!-- Graphs -->
        <!--<script src="lib/d3/d3.min.js"></script>
        <script src="lib/dangle/dist/dangle.min.js"></script>
        <script src="lib/dangle/dist/dangle.module.min.js"></script>
        <script src="lib/dangle/dist/dangle.bar.min.js"></script>-->

        <!-- cordova script (this will be a 404 during development) -->
        <script src="cordova.js"></script>

        <!--
            maybe this is not the best place for this code,
            we can put it on an external file later
        -->
        <script>
            // this plugin is required:
            // cordova plugin add org.apache.cordova.network-information
            var network = {

                attempt: 1,

                get: function () {
                    return navigator.connection && navigator.connection.type;
                },

                isOnline: function (isOnlineCallback, isOfflineCallback) {
                    var self = this;
                    // in android the plugin is not ready instantly
                    setTimeout(function () {
                        var networkState = self.get(),
                            isOnline;
                        // alert(networkState);
                        if (networkState === 0 && self.attempt < 4) {
                            self.attempt++;
                            self.isOnline(isOnlineCallback, isOfflineCallback);
                        } else {
                            self.attempt = 1;
                            isOnline = networkState !== 0 && networkState !== 'unknown' &&
                                networkState !== 'none' && networkState !== undefined;
                            if (isOnline) {
                                typeof isOnlineCallback === 'function' &&
                                    isOnlineCallback();
                            } else {
                                typeof isOfflineCallback === 'function' &&
                                    isOfflineCallback();
                            }
                        }
                    }, 400);
                }
            },

            isOnline = false,
            firebaseRef,
            userRef,
            userObject;

            // use this code when send to your devide or test in emulator
            // document.addEventListener('deviceready', function () {
            //
            //     network.isOnline(
            //     // online fn
            //     function () {
            //
            //         var auth;
            //
            //         firebaseRef = new Firebase('https://cargas-app.firebaseio.com/');
            //         auth = firebaseRef.getAuth();
            //
            //         isOnline = true;
            //
            //         if (auth) {
            //             userRef = firebaseRef.child('users').child(auth.uid);
            //             userRef.once('value', function (userSnapshot) {
            //                 userObject = userSnapshot.val();
            //                 // start the application after to get the user info
            //                 angular.bootstrap(document.body, ['cargas']);
            //             });
            //         } else {
            //             angular.bootstrap(document.body, ['cargas']);
            //         }
            //     },
            //     // offline fn
            //     function () {
            //         isOnline = false;
            //         angular.bootstrap(document.body, ['cargas']);
            //     });
            //
            // }, false);


            // uncomment the next code to test on browser
            document.addEventListener('DOMContentLoaded', function () {

                var auth;

                firebaseRef = new Firebase('https://cargas-app.firebaseio.com/');
                auth = firebaseRef.getAuth();

                if (auth) {
                    userRef = firebaseRef.child('users').child(auth.uid);
                    userRef.once('value', function (userSnapshot) {
                        userObject = userSnapshot.val();
                        // start the application after to get the user info
                        angular.bootstrap(document.body, ['cargas']);
                    });
                } else {
                    angular.bootstrap(document.body, ['cargas']);
                }

            }, false);

        </script>

        <!-- your app's js -->
        <script src="js/app.js"></script>

        <script src="js/modules/overview/overview.js"></script>
        <script src="js/modules/overview/controllers/Overview.js"></script>

        <script src="js/modules/profile/profile.js"></script>
        <script src="js/modules/profile/controllers/Profile.js"></script>
        <script src="js/modules/profile/model/Profile.js"></script>

        <script src="js/modules/cars/cars.js"></script>
        <script src="js/modules/cars/controllers/Cars.js"></script>
        <script src="js/modules/cars/controllers/Cars.Form.js"></script>
        <script src="js/modules/cars/model/Car.js"></script>

        <script src="js/modules/refuels/refuels.js"></script>
        <script src="js/modules/refuels/controllers/Refuels.js"></script>
        <script src="js/modules/refuels/controllers/Refuels.Form.js"></script>
        <script src="js/modules/refuels/model/Refuel.js"></script>

        <script src="js/modules/fuels/fuels.js"></script>
        <script src="js/modules/fuels/controllers/Fuels.js"></script>
        <script src="js/modules/fuels/controllers/Fuels.Form.js"></script>
        <script src="js/modules/fuels/model/Fuel.js"></script>

        <script src="js/modules/settings/settings.js"></script>
        <script src="js/modules/settings/controllers/Settings.js"></script>
        <script src="js/modules/settings/controllers/Units.js"></script>
        <script src="js/modules/settings/controllers/Languages.js"></script>
        <script src="js/modules/settings/model/Setting.js"></script>

        <script src="js/modules/stats/stats.js"></script>
        <script src="js/modules/stats/controllers/Stats.js"></script>

        <script src="js/modules/utils/utils.js"></script>

        <script src="js/modules/intro/intro.js"></script>
        <script src="js/modules/intro/controllers/intro.js"></script>
    </head>
    <body>
        <ion-nav-view></ion-nav-view>
    </body>
</html>
